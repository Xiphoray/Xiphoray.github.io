<style>:root{--bg-day:#f7f7f7;--fg-day:#222;--bg-night:#0b0c10;--fg-night:#e6e6e6;--accent:#0d6efd;--wheel-speed:300ms;--mc-digit-fs:clamp(28px,12vw,56px);--mc-digit-inner-scale:0.94;--mc-digit-width:calc(var(--mc-digit-fs)*1.24);--mc-digit-height:calc(var(--mc-digit-fs)*1.57);--mc-gap:clamp(3px,1.8vw,8px)}#moneyclock-app{height:100%;z-index:199999;position:relative}body{font-family:"Segoe UI","SegoeUI","Microsoft Yahei UI","Helvetica Neue",Arial,sans-serif;font-weight:700;background:#f7f7f7;color:#222}@media(prefers-color-scheme:dark){body,#moneyclock-app{background:var(--bg-night);color:var(--fg-night)}}@media(max-width:420px){:root{--mc-digit-inner-scale:0.9}}@media(max-width:360px){:root{--mc-digit-inner-scale:0.86}}#moneyclock-app{display:flex;align-items:center;justify-content:center;text-align:center;min-height:100vh}#moneyclock-app.moneyclock-container{padding-left:clamp(12px,4vw,20px);padding-right:clamp(12px,4vw,20px)}.moneyclock-container{width:100%;max-width:960px;margin:0 auto;box-sizing:border-box}.moneyclock-wage{display:inline-flex;align-items:center;justify-content:center;gap:var(--mc-gap);line-height:1;margin:0 auto;max-width:100%;overflow:hidden;transform-origin:center center;will-change:transform}.moneyclock-wage>*{margin-right:var(--mc-gap)}.moneyclock-wage>*:last-child{margin-right:0}.moneyclock-digit{position:relative;width:var(--mc-digit-width);height:var(--mc-digit-height);overflow:hidden;border-radius:10px;background:rgba(0,0,0,0.04);box-shadow:inset 0 1px 2px rgba(0,0,0,0.08)}@media(prefers-color-scheme:dark){.moneyclock-digit{background:rgba(255,255,255,0.06);box-shadow:inset 0 1px 2px rgba(255,255,255,0.06)}}.moneyclock-wheel{position:absolute;left:0;top:0;width:100%;will-change:transform;transition:transform var(--wheel-speed)ease-in-out}.moneyclock-wheel span{display:flex;align-items:center;justify-content:center;height:var(--mc-digit-height);width:100%;padding:0 2px;font-size:calc(var(--mc-digit-fs)*var(--mc-digit-inner-scale));font-variant-numeric:tabular-nums;font-feature-settings:"tnum"1}.moneyclock-decimal{width:auto;padding:0 calc(var(--mc-digit-fs)*0.14);font-size:var(--mc-digit-fs)}.moneyclock-currency{width:auto;padding:0 calc(var(--mc-digit-fs)*0.21);font-size:var(--mc-digit-fs)}.moneyclock-gear{position:fixed;top:12px;right:12px;opacity:.8;z-index:200000}.moneyclock-gear svg{width:clamp(20px,6vw,28px);height:clamp(20px,6vw,28px)}.moneyclock-gear:hover{opacity:1;color:#0d6efd}.modal{z-index:200000}.modal.form-label{font-weight:600}.modal.control-label{font-weight:600}.modal-body.form-group{margin-bottom:12px}.modal-body.form-control{max-width:none;margin:0 auto}.modal-body.checkbox{margin:8px 0 12px}.moneyclock-time-field{position:relative;display:block;width:240px;margin:0 auto}.moneyclock-time-field.moneyclock-time-input{width:100%;box-sizing:border-box;color:inherit}.moneyclock-time-input::-webkit-calendar-picker-indicator{opacity:.85;filter:none}@media(prefers-color-scheme:dark){.moneyclock-time-input::-webkit-calendar-picker-indicator{filter:invert(1)brightness(1.2)}}.modal-content{background-color:#ffffff;color:var(--fg-day)}.modal-header,.modal-footer{border-color:rgba(0,0,0,0.1)}.form-control,.form-select{background-color:#ffffff;color:var(--fg-day)}#moneyclock-settings-modal.modal-title{font-weight:800;font-size:22px}@media(prefers-color-scheme:dark){.modal-content{background-color:#14161a;color:var(--fg-night);border-color:rgba(255,255,255,0.15)}.modal-header,.modal-footer{border-color:rgba(255,255,255,0.12)}.form-control,.form-select{background-color:#0f1115;color:var(--fg-night);border-color:rgba(255,255,255,0.18)}.form-control::placeholder{color:rgba(230,230,230,0.55)}.form-check-label{color:var(--fg-night)}.form-check-input{background-color:#0f1115;border-color:rgba(255,255,255,0.25)}.form-check-input:checked{background-color:#0d6efd;border-color:#0d6efd}.moneyclock-time-field.moneyclock-time-icon{opacity:.9}}.moneyclock-tabs{display:flex;justify-content:center;margin:10px 0 16px}.moneyclock-tabs-inner{position:relative;display:inline-flex;gap:8px;align-items:center;padding:4px;background:rgba(0,0,0,0.04);border-radius:999px}.moneyclock-tab{position:relative;z-index:1;border:0;background:transparent;color:inherit;font-weight:700;padding:6px 14px;border-radius:999px;cursor:pointer}.moneyclock-tab[aria-selected="true"],.moneyclock-tab.active{color:#000}.moneyclock-tab-indicator{position:absolute;top:2px;height:calc(100%-4px);left:0;width:0;border-radius:999px;background:rgba(0,0,0,0.12);transition:transform.2s ease,width.2s ease}@media(prefers-color-scheme:dark){.moneyclock-tabs-inner{background:rgba(255,255,255,0.06)}.moneyclock-tab[aria-selected="true"],.moneyclock-tab.active{color:#fff}.moneyclock-tab-indicator{background:rgba(255,255,255,0.16)}}.moneyclock-countdown{margin-top:16px}.moneyclock-countdown-label{opacity:.8;margin-bottom:4px}.moneyclock-countdown-time{font-family:"Segoe UI","SegoeUI",Consolas,monospace;font-weight:700;font-size:clamp(16px,6vw,24px)}</style><div id="moneyclock-app"class="moneyclock-app"><div class="moneyclock-container"><div class="moneyclock-gear"id="moneyclock-btn-settings"role="button"aria-label="设置"title="设置"><svg xmlns="http://www.w3.org/2000/svg"width="28"height="28"viewBox="0 0 24 24"fill="currentColor"><path d="M19.14,12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.37,7.37,0,0,0-1.63-.94l-.36-2.54A.5.5 0 0 0,13.9,1H10.1a.5.5 0 0 0-.5.42L9.24,3.96a7.37,7.37,0,0,0-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.7,7.48a.5.5 0 0 0,.12.64L4.85,9.7c-.04.31-.06.63-.06.94s.02.63.06.94L2.82,13.16a.5.5 0 0 0-.12.64l1.92,3.32a.5.5 0 0 0,.6.22l2.39-.96c.5.4,1.04.72,1.63.94l.36,2.54a.5.5 0 0 0,.5.42h3.8a.5.5 0 0 0,.5-.42l.36-2.54c.59-.22,1.13-.54,1.63-.94l2.39.96a.5.5 0 0 0,.6-.22l1.92-3.32a.5.5 0 0 0-.12-.64ZM12,15.5A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/></svg></div><div class="moneyclock-tabs"id="moneyclock-tabs"role="tablist"aria-label="薪资视图切换"><div class="moneyclock-tabs-inner"><button type="button"id="moneyclock-tab-today"class="moneyclock-tab active"data-kind="today"role="tab"aria-selected="true">今日已获薪水</button><button type="button"id="moneyclock-tab-year"class="moneyclock-tab"data-kind="year"role="tab"aria-selected="false">今年已获薪水</button><button type="button"id="moneyclock-tab-since"class="moneyclock-tab"data-kind="since"role="tab"aria-selected="false">入职已获薪水</button><div class="moneyclock-tab-indicator"id="moneyclock-tab-indicator"aria-hidden="true"></div></div></div><div id="moneyclock-wage"class="moneyclock-wage"aria-live="polite"aria-label="今天已获得工资"></div><div class="moneyclock-countdown"id="moneyclock-countdown"aria-live="polite"><div class="moneyclock-countdown-label"id="moneyclock-countdown-label">距离下班还剩下</div><div class="moneyclock-countdown-time"id="moneyclock-countdown-time">00:00:00</div></div></div></div><!--设置Modal--><div class="modal fade"id="moneyclock-settings-modal"tabindex="-1"aria-labelledby="settingsLabel"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button"class="close"data-dismiss="modal"aria-label="关闭"><span aria-hidden="true">&times;</span></button><h5 class="modal-title"id="settingsLabel">设置</h5></div><div class="modal-body"><form id="settings-form"><div class="form-group"><label class="control-label">月薪（元）</label><input type="number"step="0.01"min="0"class="form-control"id="moneyclock-salaryMonthly"/></div><div class="form-group"><label class="control-label">每月上班天数</label><input type="number"step="0.01"min="1"class="form-control"id="moneyclock-workDaysPerMonth"/></div><div class="form-group"><label class="control-label">入职日期（年月）</label><input type="month"class="form-control"id="moneyclock-hireMonth"/></div><div class="row"><div class="col-sm-6"><div class="form-group"><label class="control-label">上班开始</label><div class="moneyclock-time-field"><input type="time"class="form-control moneyclock-time-input"id="moneyclock-workStart"/></div></div></div><div class="col-sm-6"><div class="form-group"><label class="control-label">上班结束</label><div class="moneyclock-time-field"><input type="time"class="form-control moneyclock-time-input"id="moneyclock-workEnd"/></div></div></div></div><div class="row"><div class="col-sm-6"><div class="form-group"><label class="control-label">午休开始</label><div class="moneyclock-time-field"><input type="time"class="form-control moneyclock-time-input"id="moneyclock-lunchStart"/></div></div></div><div class="col-sm-6"><div class="form-group"><label class="control-label">午休结束</label><div class="moneyclock-time-field"><input type="time"class="form-control moneyclock-time-input"id="moneyclock-lunchEnd"/></div></div></div></div><div class="checkbox"><label><input type="checkbox"id="moneyclock-includeLunch"/>上班时间包含午休</label></div><div class="form-group"><label class="control-label">刷新时间（秒）</label><input type="number"step="1"min="1"class="form-control"id="moneyclock-refreshSec"/></div></form></div><div class="modal-footer"><button type="button"class="btn btn-primary"id="save-settings">确认</button></div></div></div></div><script>(function($){const COOKIE_NAME='mc_settings';const COOKIE_DAYS=365;const DEFAULTS={salaryMonthly:7000,workDaysPerMonth:21.75,hireMonth:'2020-07',workStart:'08:00',workEnd:'17:30',lunchStart:'11:30',lunchEnd:'13:00',includeLunch:true,refreshSec:1};const Storage=(()=>{let cookieTested=false;let cookieUsable=false;function canUseCookie(){if(cookieTested)return cookieUsable;cookieTested=true;try{const k='__mc_test__';document.cookie=`${k}=1;max-age=5;path=/`;const ok=/(?:^|; )__mc_test__=1(?:;|$)/.test(document.cookie);document.cookie=`${k}=;expires=Thu,01 Jan 1970 00:00:00 GMT;path=/`;cookieUsable=!!ok}catch{cookieUsable=false}return cookieUsable}return{get(){if(canUseCookie()){const raw=readCookie(COOKIE_NAME);if(raw!=null)return decodeURIComponent(raw)}try{return window.localStorage.getItem(COOKIE_NAME)}catch{return null}},set(str){let wrote=false;if(canUseCookie()){try{writeCookie(COOKIE_NAME,encodeURIComponent(str),COOKIE_DAYS);const back=readCookie(COOKIE_NAME);wrote=(back!=null)}catch{wrote=false}}if(!wrote){try{window.localStorage.setItem(COOKIE_NAME,str);wrote=true}catch{}}return wrote}}})();let settings=null;let ticker=null;let lastDisplay=null;let modal=null;const SEL={wage:'#moneyclock-wage',btn:'#moneyclock-btn-settings',modal:'#moneyclock-settings-modal',salaryMonthly:'#moneyclock-salaryMonthly',workDaysPerMonth:'#moneyclock-workDaysPerMonth',hireMonth:'#moneyclock-hireMonth',workStart:'#moneyclock-workStart',workEnd:'#moneyclock-workEnd',lunchStart:'#moneyclock-lunchStart',lunchEnd:'#moneyclock-lunchEnd',includeLunch:'#moneyclock-includeLunch',refreshSec:'#moneyclock-refreshSec',tabsWrap:'#moneyclock-tabs',tabToday:'#moneyclock-tab-today',tabYear:'#moneyclock-tab-year',tabSince:'#moneyclock-tab-since',tabIndicator:'#moneyclock-tab-indicator',cdWrap:'#moneyclock-countdown',cdLabel:'#moneyclock-countdown-label',cdTime:'#moneyclock-countdown-time',};let currentMode='today';function init(){buildDisplay('0.00');modal=$(SEL.modal);bindUI();const loaded=loadSettings();if(!loaded){settings={...DEFAULTS};saveSettings(settings);fillForm();startTicker();modal.modal('show')}else{settings=loaded;fillForm();startTicker()}}function bindUI(){$(SEL.btn).on('click',()=>{fillForm();modal.modal('show')});$(SEL.tabToday+','+SEL.tabYear+','+SEL.tabSince).on('click',function(){const kind=$(this).data('kind');selectMode(kind);renderOnce()});$(document).on('keydown','.moneyclock-time-input',function(e){if($.inArray(e.which,[9,37,38,39,40])!==-1)return;e.preventDefault()});$(document).on('paste drop','.moneyclock-time-input',function(e){e.preventDefault()});$(SEL.workStart+','+SEL.workEnd+','+SEL.lunchStart+','+SEL.lunchEnd).on('change',function(){validateTimes(true)});$('#save-settings').on('click',()=>{const s=readForm();if(!s)return;settings=s;saveSettings(settings);startTicker();modal.modal('hide')})}function buildDisplay(text){const $wrap=$(SEL.wage);$wrap.empty();$wrap.append($('<div class=\"moneyclock-currency\">¥</div>'));const[intPart,fracPart]=text.split('.');const digits=(intPart).split('');digits.forEach((d)=>$wrap.append(makeDigit(parseInt(d,10)||0)));$wrap.append($('<div class=\"moneyclock-decimal\">.</div>'));const fds=(fracPart||'00').padEnd(2,'0').slice(0,2).split('');fds.forEach((d)=>$wrap.append(makeDigit(parseInt(d,10)||0)));lastDisplay=formatFixed(text);fitWage()}const REPEAT_CYCLES=7;const CYCLE_SIZE=10;const MIDDLE_BASE=Math.floor(REPEAT_CYCLES/2)*CYCLE_SIZE;function makeDigit(initial){const $d=$('<div class="moneyclock-digit" role="img" aria-label="digit"></div>');const $wheel=$('<div class="moneyclock-wheel"></div>');for(let r=0;r<REPEAT_CYCLES;r++){for(let i=0;i<10;i++)$wheel.append($('<span></span>').text(i))}$d.append($wheel);setWheel($wheel,initial);return $d}function setWheel($wheel,n){const h=getDigitHeight();const idx=(n%10+10)%10;const abs=MIDDLE_BASE+idx;$wheel.css('transition','none');$wheel.css('transform',`translateY(${-abs*h}px)`);requestAnimationFrame(()=>{$wheel.css('transition','transform var(--wheel-speed) ease-in-out')});$wheel.data('pos',abs)}function rollWheel($wheel,from,to){if(!$wheel||!$wheel.length)return;const h=getDigitHeight();const cur=(from%10+10)%10;const nxt=(to%10+10)%10;const steps=(nxt>=cur)?(nxt-cur):(10-cur+nxt);const maxIndex=REPEAT_CYCLES*CYCLE_SIZE-1;let norm=MIDDLE_BASE+nxt;while(norm<0)norm+=CYCLE_SIZE;while(norm>maxIndex)norm-=CYCLE_SIZE;let start=norm-steps;while(start<0){start+=CYCLE_SIZE;norm+=CYCLE_SIZE}while(norm>maxIndex){norm-=CYCLE_SIZE;start-=CYCLE_SIZE}const target=start+steps;$wheel.off('transitionend');$wheel.css('transition','none');$wheel.css('transform',`translateY(${-start*h}px)`);$wheel.data('pos',start);if($wheel[0])void $wheel[0].offsetHeight;$wheel.css('transition','transform var(--wheel-speed) ease-in-out');$wheel.css('transform',`translateY(${-target*h}px)`);$wheel.one('transitionend',()=>{$wheel.css('transition','none');$wheel.css('transform',`translateY(${-norm*h}px)`);requestAnimationFrame(()=>{$wheel.css('transition','transform var(--wheel-speed) ease-in-out')});$wheel.data('pos',norm)})}function updateDisplay(nextStr){nextStr=formatFixed(nextStr);if(lastDisplay===null){buildDisplay(nextStr);return}if(nextStr.length!==lastDisplay.length){buildDisplay(nextStr);return}const $wrap=$(SEL.wage);const children=$wrap.children().toArray();const prev=lastDisplay;const curr=nextStr;let acted=false;for(let i=curr.length-1;i>=0;i--){const c=curr[i];const p=prev[i];if(c==='.'||p==='.')continue;const childIndex=mapIndexToChild(i,curr.length);if(childIndex<0||childIndex>=children.length){buildDisplay(curr);lastDisplay=curr;return}const $digit=$(children[childIndex]);const $wheel=$digit.find('.moneyclock-wheel');const from=parseInt(p,10);const to=parseInt(c,10);if(!$wheel.length){buildDisplay(curr);lastDisplay=curr;return}if(p===c){setWheel($wheel,to);continue}rollWheel($wheel,from,to);acted=true}if(prev!==curr&&!acted){buildDisplay(curr)}lastDisplay=curr;fitWage()}function isSuffixRollover(prev,curr,i){let prevDigits='',currDigits='';for(let k=i+1;k<prev.length;k++){if(prev[k]!=='.')prevDigits+=prev[k]}for(let k=i+1;k<curr.length;k++){if(curr[k]!=='.')currDigits+=curr[k]}if(prevDigits.length===0||prevDigits.length!==currDigits.length)return false;return(/^9+$/.test(prevDigits)&&/^0+$/.test(currDigits))}function mapIndexToChild(i,len){const s=lastDisplay||'0.00';const decIdx=s.indexOf('.');let digitsBefore=0;for(let k=0;k<i;k++){if(s[k]!=='.')digitsBefore++}let child=1+digitsBefore;if(decIdx!==-1&&i>decIdx)child+=1;return child}function getDigitHeight(){const $tmp=$('<div class=\"moneyclock-digit\"><div class=\"moneyclock-wheel\"><span>0</span></div></div>').appendTo('body');const h=Math.round($tmp.outerHeight());$tmp.remove();return h||88}function fitWage(){const $wrap=$(SEL.wage);if(!$wrap.length)return;$wrap.css('transform','none');const $container=$wrap.closest('.moneyclock-container');const containerW=($container.length?$container.innerWidth():($wrap.parent().innerWidth()||$(window).width()));const contentW=$wrap[0]?$wrap[0].scrollWidth:containerW;if(!containerW||!contentW)return;var gap=12;const scale=Math.min(1,(containerW-gap*2)/contentW);$wrap.css('transform','scale('+scale+')')}function startTicker(){if(ticker)clearInterval(ticker);if(!settings){return}selectMode(currentMode);renderOnce();const interval=Math.max(1,parseInt(settings.refreshSec,10)||1)*1000;ticker=setInterval(renderOnce,interval);var t;$(window).off('.mcfit').on('resize.mcfit orientationchange.mcfit',function(){clearTimeout(t);t=setTimeout(function(){fitWage();positionIndicator()},100)});fitWage();positionIndicator()}function renderOnce(){let earned=0;if(currentMode==='today')earned=computeEarnedToday();else if(currentMode==='year')earned=computeEarnedYear();else earned=computeEarnedSinceHire();updateDisplay(earned.toFixed(2));updateCountdown()}function computeEarnedToday(){const daySalary=Number(settings.salaryMonthly)/Number(settings.workDaysPerMonth);if(!isFinite(daySalary)||daySalary<=0)return 0;const now=new Date();const nowSec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds()+now.getMilliseconds()/1000;const ws=toSec(settings.workStart);const we=toSec(settings.workEnd);if(!(we>ws))return 0;let worked=clamp(nowSec,ws,we)-ws;let total=Math.max(0,we-ws);const ls=toSec(settings.lunchStart);const le=toSec(settings.lunchEnd);if(!settings.includeLunch){const lunchOverlapTotal=overlap([ws,we],[ls,le]);total-=Math.max(0,lunchOverlapTotal);const until=clamp(nowSec,ws,we);const lunchOverlapSoFar=overlap([ws,until],[ls,le]);worked-=Math.max(0,lunchOverlapSoFar)}worked=Math.min(Math.max(worked,0),Math.max(total,1));const ratio=total>0?(worked/total):0;const earned=daySalary*ratio;return Math.min(daySalary,Math.max(0,earned))}function computeEarnedYear(){const today=computeEarnedToday();const m=new Date();const monthIndex=m.getMonth();const monthsBefore=monthIndex;const fullMonths=monthsBefore*Number(settings.salaryMonthly);const dim=daysInMonth(m.getFullYear(),monthIndex);const partRatio=Math.max(0,(m.getDate()-1)/dim);const daySalary=Number(settings.salaryMonthly)/Number(settings.workDaysPerMonth);const partialMonth=partRatio*Number(settings.workDaysPerMonth)*daySalary;const total=Math.max(0,fullMonths+partialMonth+today);return total}function computeEarnedSinceHire(){const today=computeEarnedToday();const now=new Date();const hire=parseHireMonth(settings.hireMonth);if(!hire)return today;let months=monthsBetweenFloor(hire,now);months=Math.max(0,months);const full=months*Number(settings.salaryMonthly);const dim=daysInMonth(now.getFullYear(),now.getMonth());const partRatio=Math.max(0,(now.getDate()-1)/dim);const daySalary=Number(settings.salaryMonthly)/Number(settings.workDaysPerMonth);const partialMonth=partRatio*Number(settings.workDaysPerMonth)*daySalary;return Math.max(0,full+partialMonth+today)}function toSec(t){if(!t||!/^\d{2}:\d{2}$/.test(t))return 0;const[h,m]=t.split(':').map(Number);return h*3600+m*60}function overlap([a1,a2],[b1,b2]){const s=Math.max(a1,b1),e=Math.min(a2,b2);return Math.max(0,e-s)}function clamp(x,a,b){return Math.min(Math.max(x,Math.min(a,b)),Math.max(a,b))}function daysInMonth(y,m){return new Date(y,m+1,0).getDate()}function parseHireMonth(str){if(!str||!/^\d{4}-\d{2}$/.test(String(str)))return null;const[Y,M]=String(str).split('-').map(Number);if(!Y||!M)return null;return new Date(Y,M-1,1)}function monthsBetweenFloor(a,b){const years=b.getFullYear()-a.getFullYear();const months=b.getMonth()-a.getMonth();let total=years*12+months;if(total<0)return total;return Math.floor(total)}function loadSettings(){const raw=Storage.get();if(!raw)return null;try{const obj=JSON.parse(raw);return{...DEFAULTS,...obj}}catch{return null}}function saveSettings(s){Storage.set(JSON.stringify(s))}function readCookie(name){const m=document.cookie.match(new RegExp('(?:^|; )'+name.replace(/([.$?*|{}()\[\]\\\/\+^])/g,'\\$1')+'=([^;]*)'));return m?m[1]:null}function writeCookie(name,value,days){const d=new Date();d.setTime(d.getTime()+days*24*60*60*1000);document.cookie=`${name}=${value};expires=${d.toUTCString()};path=/`}function fillForm(){$(SEL.salaryMonthly).val(settings.salaryMonthly);$(SEL.workDaysPerMonth).val(settings.workDaysPerMonth);$(SEL.hireMonth).val(settings.hireMonth);$(SEL.workStart).val(settings.workStart);$(SEL.workEnd).val(settings.workEnd);$(SEL.lunchStart).val(settings.lunchStart);$(SEL.lunchEnd).val(settings.lunchEnd);$(SEL.includeLunch).prop('checked',!!settings.includeLunch);$(SEL.refreshSec).val(settings.refreshSec)}function readForm(){const hire=String($(SEL.hireMonth).val()||'2020-07');const s={salaryMonthly:parseFloat($(SEL.salaryMonthly).val()),workDaysPerMonth:parseFloat($(SEL.workDaysPerMonth).val()),hireMonth:(/^\d{4}-\d{2}$/.test(hire)?hire:'2020-07'),workStart:String($(SEL.workStart).val()||'08:00'),workEnd:String($(SEL.workEnd).val()||'17:30'),lunchStart:String($(SEL.lunchStart).val()||'11:30'),lunchEnd:String($(SEL.lunchEnd).val()||'12:00'),includeLunch:!!$(SEL.includeLunch).is(':checked'),refreshSec:parseInt($(SEL.refreshSec).val(),10)||1,};if(!(s.salaryMonthly>0)||!(s.workDaysPerMonth>0)){alert('请填写有效的月薪与上班天数');return null}if(!validateTimes(true))return null;return s}function setGroupError($input,isError){var $grp=$input.closest('.form-group');$grp.toggleClass('has-error',!!isError);if(isError){$input.attr('aria-invalid','true')}else{$input.removeAttr('aria-invalid')}}function validateTimes(showAlert){var $ws=$(SEL.workStart),$we=$(SEL.workEnd),$ls=$(SEL.lunchStart),$le=$(SEL.lunchEnd);var s={workStart:String($ws.val()||'08:00'),workEnd:String($we.val()||'17:30'),lunchStart:String($ls.val()||'11:30'),lunchEnd:String($le.val()||'12:00'),};var ws=toSec(s.workStart),we=toSec(s.workEnd);var ls=toSec(s.lunchStart),le=toSec(s.lunchEnd);setGroupError($ws,false);setGroupError($we,false);setGroupError($ls,false);setGroupError($le,false);if(!(we>ws)){setGroupError($ws,true);setGroupError($we,true);if(showAlert)alert('上班时间无效：结束时间必须晚于开始时间');return false}if(!(le>ls)){setGroupError($ls,true);setGroupError($le,true);if(showAlert)alert('午休时间无效：结束时间必须晚于开始时间');return false}if(ls<ws||le>we){setGroupError($ls,true);setGroupError($le,true);if(showAlert)alert('午休时间超出上班时间范围，请调整');return false}return true}function formatFixed(v){const n=(typeof v==='number')?v:parseFloat(v);if(!isFinite(n))return'0.00';const s=n.toFixed(2);return s.replace(/^\./,'0.')}function selectMode(kind){const k=(kind==='year'||kind==='since')?kind:'today';currentMode=k;$(SEL.tabToday).toggleClass('active',k==='today').attr('aria-selected',k==='today');$(SEL.tabYear).toggleClass('active',k==='year').attr('aria-selected',k==='year');$(SEL.tabSince).toggleClass('active',k==='since').attr('aria-selected',k==='since');const label=k==='today'?'今天已获得工资':(k==='year'?'今年已获得工资':'入职以来已获得工资');$(SEL.wage).attr('aria-label',label);positionIndicator()}function positionIndicator(){const $act=$('.moneyclock-tab.active').first();const $wrap=$(SEL.tabsWrap).find('.moneyclock-tabs-inner');const $ind=$(SEL.tabIndicator);if(!$act.length||!$wrap.length||!$ind.length)return;const offA=$act.position();const w=$act.outerWidth();$ind.css('width',w+'px');$ind.css('transform','translateX('+(offA.left)+'px)')}function updateCountdown(){if(!settings)return;const now=new Date();const ws=toSec(settings.workStart);const we=toSec(settings.workEnd);const secNow=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();if(secNow>=ws&&secNow<we){$(SEL.cdLabel).text('距离下班还剩下');const left=Math.max(0,we-secNow);$(SEL.cdTime).text(secToHMS(left))}else{$(SEL.cdLabel).text('以下班');$(SEL.cdTime).text('00:00:00')}}function secToHMS(s){s=Math.max(0,Math.floor(s));const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),ss=s%60;return[h,m,ss].map(n=>String(n).padStart(2,'0')).join(':')}$(init)})(jQuery);</script>